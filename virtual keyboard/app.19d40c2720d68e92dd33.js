(()=>{"use strict";function t(t,s,l){const i=document.createElement(t);return i.className=s,l&&(i.innerHTML=l),i}const s={en:{Backquote:{small:"`",shift:"~"},Digit1:{small:"1",shift:"!"},Digit2:{small:"2",shift:"@"},Digit3:{small:"3",shift:"#"},Digit4:{small:"4",shift:"$"},Digit5:{small:"5",shift:"%"},Digit6:{small:"6",shift:"^"},Digit7:{small:"7",shift:"&"},Digit8:{small:"8",shift:"*"},Digit9:{small:"9",shift:"("},Digit0:{small:"0",shift:")"},Minus:{small:"-",shift:"_"},Equal:{small:"=",shift:"+"},Backspace:{small:"Backspace",shift:null},Delete:{small:"Delete",shift:null},Tab:{small:"Tab",shift:null},KeyQ:{small:"q",shift:"Q"},KeyW:{small:"w",shift:"W"},KeyE:{small:"e",shift:"E"},KeyR:{small:"r",shift:"R"},KeyT:{small:"t",shift:"T"},KeyY:{small:"y",shift:"Y"},KeyU:{small:"u",shift:"U"},KeyI:{small:"i",shift:"I"},KeyO:{small:"o",shift:"O"},KeyP:{small:"p",shift:"P"},BracketLeft:{small:"[",shift:"{"},BracketRight:{small:"]",shift:"}"},Enter:{small:"Enter",shift:null},CapsLock:{small:"CapsLock",shift:null},KeyA:{small:"a",shift:"A"},KeyS:{small:"s",shift:"S"},KeyD:{small:"d",shift:"D"},KeyF:{small:"f",shift:"F"},KeyG:{small:"g",shift:"G"},KeyH:{small:"h",shift:"H"},KeyJ:{small:"j",shift:"J"},KeyK:{small:"k",shift:"K"},KeyL:{small:"l",shift:"L"},Semicolon:{small:";",shift:":"},Quote:{small:"'",shift:'"'},Backslash:{small:"\\",shift:"|"},ShiftLeft:{small:"Shift",shift:null},IntlBackslash:{small:"<",shift:">"},KeyZ:{small:"z",shift:"Z"},KeyX:{small:"x",shift:"X"},KeyC:{small:"c",shift:"C"},KeyV:{small:"v",shift:"V"},KeyB:{small:"b",shift:"B"},KeyN:{small:"n",shift:"N"},KeyM:{small:"m",shift:"M"},Comma:{small:",",shift:"<"},Period:{small:".",shift:">"},Slash:{small:"/",shift:"?"},ShiftRight:{small:"Shift",shift:null},ControlLeft:{small:"Ctrl",shift:null},AltLeft:{small:"Alt",shift:null},Space:{small:" ",shift:null},AltRight:{small:"Alt",shift:null},ControlRight:{small:"Ctrl",shift:null},ArrowLeft:{small:"&larr;",shift:null},ArrowUp:{small:"&uarr;",shift:null},ArrowDown:{small:"&darr;",shift:null},ArrowRight:{small:"&rarr;",shift:null},Win:{small:"Win",shift:null}},ru:{ShiftLeft:{small:"Shift",shift:null},CapsLock:{small:"CapsLock",shift:null},Backquote:{small:"ё",shift:"Ё"},Digit1:{small:"1",shift:"!"},Digit2:{small:"2",shift:'"'},Digit3:{small:"3",shift:"№"},Digit4:{small:"4",shift:";"},Digit5:{small:"5",shift:"%"},Digit6:{small:"6",shift:":"},Digit7:{small:"7",shift:"?"},Digit8:{small:"8",shift:"*"},Digit9:{small:"9",shift:"("},Digit0:{small:"0",shift:")"},Minus:{small:"-",shift:"_"},Equal:{small:"=",shift:"+"},Backspace:{small:"Backspace",shift:null},Delete:{small:"Delete",shift:null},Tab:{small:"Tab",shift:null},KeyQ:{small:"й",shift:"Й"},KeyW:{small:"ц",shift:"Ц"},KeyE:{small:"у",shift:"У"},KeyR:{small:"к",shift:"К"},KeyT:{small:"е",shift:"Е"},KeyY:{small:"н",shift:"Н"},KeyU:{small:"г",shift:"Г"},KeyI:{small:"ш",shift:"Ш"},KeyO:{small:"щ",shift:"Щ"},KeyP:{small:"з",shift:"З"},BracketLeft:{small:"х",shift:"Х"},BracketRight:{small:"ъ",shift:"Ъ"},Enter:{small:"Enter",shift:null},KeyA:{small:"ф",shift:"Ф"},KeyS:{small:"ы",shift:"Ы"},KeyD:{small:"в",shift:"В"},KeyF:{small:"а",shift:"А"},KeyG:{small:"п",shift:"П"},KeyH:{small:"р",shift:"Р"},KeyJ:{small:"о",shift:"О"},KeyK:{small:"л",shift:"Л"},KeyL:{small:"д",shift:"Д"},Semicolon:{small:"ж",shift:"Ж"},Quote:{small:"э",shift:"Э"},Backslash:{small:"\\",shift:"/"},Shift:{small:"Shift",shift:null},IntlBackslash:{small:"/",shift:"|"},KeyZ:{small:"я",shift:"Я"},KeyX:{small:"ч",shift:"Ч"},KeyC:{small:"с",shift:"С"},KeyV:{small:"м",shift:"М"},KeyB:{small:"и",shift:"И"},KeyN:{small:"т",shift:"Т"},KeyM:{small:"ь",shift:"Ь"},Comma:{small:"б",shift:"Б"},Period:{small:"ю",shift:"Ю"},Slash:{small:".",shift:","},ShiftRight:{small:"Shift",shift:null},ControlLeft:{small:"Ctrl",shift:null},AltLeft:{small:"Alt",shift:null},Space:{small:" ",shift:null},AltRight:{small:"Alt",shift:null},ControlRight:{small:"Ctrl",shift:null},ArrowLeft:{small:"&larr;",shift:null},ArrowUp:{small:"&uarr;",shift:null},ArrowDown:{small:"&darr;",shift:null},ArrowRight:{small:"&rarr;",shift:null},Win:{small:"Win",shift:null}}};class l{constructor(s,{small:l,shift:i}){this.small=l,this.shift=i,this.code=s,this.isFn=!i,this.isLetter=l.toUpperCase()===i,this.isSymbol=!this.isFn&&!this.isLetter,this.isSymbol?(this.shiftTitle=t("div","key__symbol inactive",this.shift),this.title=t("div","key__symbol active",this.small)):(this.title=t("div","key__title active",this.small),this.isLetter&&(this.shiftTitle=t("div","key__title inactive",this.shift)),this.isFn&&(this.shiftTitle="")),this.key=t("div","key"),this.isFn&&this.key.classList.add("key_fn"),this.shiftTitle&&this.key.append(this.shiftTitle),this.key.dataset.code=s,this.key.append(this.title)}}const i=[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace"],["Tab","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","Delete"],["CapsLock","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter"],["ShiftLeft","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","ArrowUp","ShiftRight"],["ControlLeft","Win","AltLeft","Space","AltRight","ArrowLeft","ArrowDown","ArrowRight","ControlRight"]],e=function(t,s='"en"'){return JSON.parse(localStorage.getItem(t)||s)}("vkLang-EM"),a=t("main","container"),h=t("textarea","textarea"),n=t("div","keyboard");document.body.append(a),a.append(t("h1","title","Virtual Keyboard"),t("h3","subtitle","made under Windows OS"),t("p","text","Use <kbd>Shift</kbd> + <kbd>Alt</kbd> to switch language"),h,n);const f=new class{constructor(t,s,l){this.lang=t,this.output=s,this.container=l}init(){return this.isCaps=!1,this.isShift=!1,this.langLayout=s[this.lang],this.buttons=i.map((t=>t.map((t=>new l(t,this.langLayout[t]))))),this}render(){this.container.innerHTML="",this.buttons.forEach((s=>{const l=t("div","keyboard__row");s.forEach((t=>{l.append(t.key)})),this.container.append(l)})),this.buttons=this.buttons.flat()}handleEvent=t=>{if(!t.code&&!t.target.closest(".key"))return;const s=t.code||t.target.closest(".key").dataset.code;if(s.match(/Tab|CapsLock|Shift.*|Control.*|Alt.*|Win/)&&t.repeat)return;const l=this.buttons.find((t=>t.code===s));if(!l)return;const{type:i}=t;if(t.stopPropagation(),t.preventDefault(),this.output.focus(),s.match(/Shift.*/))this.handleShift(i,l);else if(s.match(/CapsLock/))this.handleCaps(i,l);else{if(i.match(/(key|mouse)down/))if(i.match(/mousedown/)&&l.key.addEventListener("mouseleave",this.handleEvent),l.key.classList.add("key_active"),s.match(/Alt.*/)&&(this.isAlt=!0,this.isShift&&this.toggleLanguage()),l.isFn){if(s.match(/Control.*|Alt.*|Win/))return;this.printToOutput(null,s)}else this.isShift&&(!this.isCaps||!l.isLetter)||!this.isShift&&this.isCaps&&l.isLetter?this.printToOutput(l.shift):this.printToOutput(l.small);i.match(/keyup|mouseup|mouseleave/)&&(i.match(/mouseup|mouseleave/)&&l.key.removeEventListener("mouseleave",this.handleEvent),l.key.classList.remove("key_active"),s.match(/Alt.*/)&&(this.isAlt=!1))}};toggleLanguage(){const t=Object.keys(s);let l=t.indexOf(this.lang)+1;l===t.length&&(l=0),this.lang=t[l],this.init().render()}handleShift(t,s){switch(t){case"keydown":this.isShift=!0,s.key.classList.add("key_active");break;case"mousedown":this.isShift=!this.isShift,s.key.classList.toggle("key_active");break;case"keyup":if(!1===this.isShift)return;this.isShift=!1,s.key.classList.remove("key_active");break;default:return}this.buttons.forEach((t=>{t.isFn||t.key.childNodes.forEach((t=>{t.classList.toggle("inactive"),t.classList.toggle("active")}))})),this.isShift&&this.isAlt&&this.toggleLanguage()}handleCaps(t,s){t.match(/(key|mouse)down/)&&(this.isCaps=!this.isCaps,s.key.classList.toggle("key_active"),this.buttons.forEach((t=>{t.isLetter&&t.key.childNodes.forEach((t=>{t.classList.toggle("inactive"),t.classList.toggle("active")}))})))}printToOutput(t,s){let l=this.output.selectionStart;const i=this.output.selectionEnd,e=i-l,a=this.output.value.slice(0,l),h=this.output.value.slice(i);t?(this.output.value=`${a}${t}${h}`,l++):{Tab:()=>{this.output.value=`${a}\t${h}`,l++},Enter:()=>{this.output.value=`${a}\n${h}`,l++},Delete:()=>{this.output.value=e?`${a}${h}`:`${a}${h.slice(1)}`},Backspace:()=>{this.output.value=e?`${a}${h}`:`${a.slice(0,-1)}${h}`,!e&&l&&l--},ArrowLeft:()=>{0!==l&&l--},ArrowRight:()=>{l!==this.output.value.length&&l++},ArrowUp:()=>{const t=this.output.value.slice(0,l).match(/(\n).*$(?!\1)/g)||[[1]];l-=t[0].length},ArrowDown:()=>{const t=this.output.value.slice(l).match(/^.*(\n).*(?!\1)/)||[[1]];l+=t[0].length},Space:()=>{this.output.value=`${a} ${h}`,l++}}[s](),this.output.setSelectionRange(l,l)}}(e,h,n);f.init().render(),document.addEventListener("keydown",f.handleEvent),document.addEventListener("keyup",f.handleEvent),n.addEventListener("mousedown",f.handleEvent),n.addEventListener("mouseup",f.handleEvent),window.addEventListener("beforeunload",(()=>{var t;t=f.lang,localStorage.setItem("vkLang-EM",JSON.stringify(t))}))})();